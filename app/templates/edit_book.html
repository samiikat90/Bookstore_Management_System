<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <title>Edit Book</title>
 <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body class="bg-light">
 <nav class="navbar navbar-expand-lg navbar-light bg-white mb-4">
 <a class="navbar-brand" href="{{ url_for('admin_dashboard') }}">Admin Dashboard</a>
 <div class="ml-auto">
 <a class="btn btn-outline-secondary" href="{{ url_for('admin_dashboard') }}">Back to Dashboard</a>
 </div>
 </nav>

 <div class="container mt-4">
 <h1 class="mb-4">Edit Book</h1>

 <!-- Display flash messages -->
 {% with messages = get_flashed_messages(with_categories=true) %}
 {% if messages %}
 {% for category, message in messages %}
 <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
 {{ message }}
 <button type="button" class="close" data-dismiss="alert">&times;</button>
 </div>
 {% endfor %}
 {% endif %}
 {% endwith %}

 <!-- Edit book form -->
 <div class="card">
 <div class="card-header">Edit Book Details</div>
 <div class="card-body">
 <form method="POST">
 <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
 <!-- ISBN (read-only) -->
 <div class="form-group">
 <label for="isbn">ISBN</label>
 <input type="text" name="isbn" class="form-control" value="{{ book.isbn }}" readonly>
 </div>

 <!-- Title input -->
 <div class="form-group">
 <label for="title">Title</label>
 <input type="text" name="title" class="form-control" value="{{ book.title }}" required>
 </div>

 <!-- Author input -->
 <div class="form-group">
 <label for="author">Author</label>
 <input type="text" name="author" class="form-control" value="{{ book.author }}" required>
 </div>

 <!-- Price input -->
 <div class="form-group">
 <label for="price">Price</label>
 <input type="number" step="0.01" name="price" class="form-control" value="{{ book.price }}" required>
 </div>

 <!-- Quantity input -->
 <div class="form-group">
 <label for="quantity">Quantity</label>
 <input type="number" name="quantity" class="form-control" value="{{ book.quantity }}" required>
 </div>

 <!-- Cover type dropdown -->
 <div class="form-group">
 <label for="cover_type">Cover Type</label>
 <select name="cover_type" class="form-control">
 <option value="Hardcover" {% if book.cover_type == 'Hardcover' %}selected{% endif %}>Hardcover</option>
 <option value="Paperback" {% if book.cover_type == 'Paperback' %}selected{% endif %}>Paperback</option>
 </select>
 </div>

 <!-- Genre dropdown -->
 <div class="form-group">
 <label for="genre">Genre</label>
 <select name="genre" class="form-control">
 <option value="">Select genre</option>
 <option value="Fiction" {% if book.genre == 'Fiction' %}selected{% endif %}>Fiction</option>
 <option value="Mystery" {% if book.genre == 'Mystery' %}selected{% endif %}>Mystery</option>
 <option value="Romance" {% if book.genre == 'Romance' %}selected{% endif %}>Romance</option>
 <option value="Science Fiction" {% if book.genre == 'Science Fiction' %}selected{% endif %}>Science Fiction</option>
 <option value="Fantasy" {% if book.genre == 'Fantasy' %}selected{% endif %}>Fantasy</option>
 <option value="Biography" {% if book.genre == 'Biography' %}selected{% endif %}>Biography</option>
 <option value="History" {% if book.genre == 'History' %}selected{% endif %}>History</option>
 <option value="Self-Help" {% if book.genre == 'Self-Help' %}selected{% endif %}>Self-Help</option>
 <option value="Horror" {% if book.genre == 'Horror' %}selected{% endif %}>Horror</option>
 <option value="Thriller" {% if book.genre == 'Thriller' %}selected{% endif %}>Thriller</option>
 <option value="Adventure" {% if book.genre == 'Adventure' %}selected{% endif %}>Adventure</option>
 <option value="Children" {% if book.genre == 'Children' %}selected{% endif %}>Children</option>
 <option value="Young Adult" {% if book.genre == 'Young Adult' %}selected{% endif %}>Young Adult</option>
 <option value="Poetry" {% if book.genre == 'Poetry' %}selected{% endif %}>Poetry</option>
 <option value="Drama" {% if book.genre == 'Drama' %}selected{% endif %}>Drama</option>
 <option value="Philosophy" {% if book.genre == 'Philosophy' %}selected{% endif %}>Philosophy</option>
 <option value="Psychology" {% if book.genre == 'Psychology' %}selected{% endif %}>Psychology</option>
 <option value="Business" {% if book.genre == 'Business' %}selected{% endif %}>Business</option>
 <option value="Health & Wellness" {% if book.genre == 'Health & Wellness' %}selected{% endif %}>Health & Wellness</option>
 <option value="Travel" {% if book.genre == 'Travel' %}selected{% endif %}>Travel</option>
 </select>
 </div>

 <!-- Description textarea -->
 <div class="form-group">
 <label for="description">Book Description</label>
 <textarea name="description" class="form-control" rows="3">{{ book.description or '' }}</textarea>
 </div>

 <!-- Submit buttons -->
 <button type="submit" class="btn btn-primary">Update Book</button>
 <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">Cancel</a>
 </form>
 </div>
 </div>
 </div>

 <!-- Bootstrap JS -->
 <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
 
 <script>
 // Automatic logout when browser/tab is closed (less sensitive)
 let isLoggedOut = false;
 let isNavigating = false;

 function performLogout() {
 if (!isLoggedOut && !isNavigating) {
 isLoggedOut = true;
 navigator.sendBeacon('{{ url_for("logout_ajax") }}', new FormData());
 }
 }

 // Mark when we're navigating to another page in the same app
 document.addEventListener('click', function(event) {
 const link = event.target.closest('a');
 if (link && link.href && link.href.includes(window.location.origin)) {
 isNavigating = true;
 setTimeout(function() {
 isNavigating = false;
 }, 1000);
 }
 });

 // Only logout on actual browser close, not navigation
 window.addEventListener('beforeunload', function(event) {
 if (!isNavigating) {
 performLogout();
 }
 });
 </script>
</body>
</html>
